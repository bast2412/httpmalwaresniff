#!python
# coding: utf-8
import win32com.shell.shell as win32shell
import sys
import ctypes

def run_as_admin(argv=None, debug=False):
    shell32 = ctypes.windll.shell32
    if argv is None and shell32.IsUserAnAdmin():
        return True
        
    if argv is None:
        argv = sys.argv
    if hasattr(sys, '_MEIPASS'):
        # Support pyinstaller wrapped program.
        arguments = list(map(str, argv[1:]))
    else:
        arguments = list(map(str, argv))
    argument_line = ' '.join(arguments)
    executable = str(sys.executable)
    if debug:
        print('Command line: ', executable, argument_line)
    ret = shell32.ShellExecuteW(None, "runas", executable, argument_line, None, 1)
    if int(ret) <= 32:
        return False
    return None


def disable_UAC():
    command1 = 'reg delete HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA'
    win32shell.ShellExecuteEx(
        lpVerb='runas', lpFile='cmd.exe', lpParameters='/c ' + command1)
    command2 = 'reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f'
    win32shell.ShellExecuteEx(
        lpVerb='runas', lpFile='cmd.exe', lpParameters='/c ' + command2)

if __name__ == '__main__':
	disable_UAC()
	ret = run_as_admin()
	if ret is True:
		print('I have admin privilege.')
		input('Press ENTER to exit.')
	elif ret is None:
		print('I am elevating to admin privilege.')
		input('Press ENTER to exit.')
	else:
		print('Error(ret=%d): cannot elevate privilege.' % (ret, ))
